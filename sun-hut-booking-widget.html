<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sun Hut - Book Your Tan</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #FFF7ED 0%, #FFEDD5 100%);
        }
        
        /* Sun Hut Theme Colors */
        .sun-hut-orange { background-color: #FF6B35; }
        .sun-hut-yellow { background-color: #FFD700; }
        .sun-hut-text-orange { color: #FF6B35; }
        .sun-hut-border-orange { border-color: #FF6B35; }
        
        /* Tropical Pattern Background */
        .tropical-bg {
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 107, 53, 0.1) 0%, transparent 50%);
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid #FED7AA;
            border-top-color: #FF6B35;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #FED7AA;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #FF6B35;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #E55A2B;
        }
        
        /* Button Hover Effects */
        .btn-orange {
            background-color: #FF6B35;
            transition: all 0.3s ease;
        }
        
        .btn-orange:hover {
            background-color: #E55A2B;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }
        
        .btn-yellow {
            background-color: #FFD700;
            color: #1F2937;
            transition: all 0.3s ease;
        }
        
        .btn-yellow:hover {
            background-color: #FFC700;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
        }
        
        /* Card Styles */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        /* Input Focus Styles */
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #FF6B35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        
        /* Time Slot Styles */
        .time-slot {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid #E5E7EB;
        }
        
        .time-slot:hover {
            border-color: #FF6B35;
            background-color: #FFF7ED;
        }
        
        .time-slot.selected {
            border-color: #FF6B35;
            background-color: #FFEDD5;
        }
        
        .time-slot.unavailable {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #F3F4F6;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCRiybLgwke4e38h72ElcvD5Fo_uS3eyQM",
            authDomain: "tanningsalon-b67a2.firebaseapp.com",
            projectId: "tanningsalon-b67a2",
            storageBucket: "tanningsalon-b67a2.firebasestorage.app",
            messagingSenderId: "407378831723",
            appId: "1:407378831723:web:2642c751f4c7c90b37042e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Main App Component
        function BookingWidget() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('login'); // login, register, booking, myAppointments
            const [resources, setResources] = useState([]);
            const [services, setServices] = useState([]);
            const [appointments, setAppointments] = useState([]);
            const [clients, setClients] = useState([]);

            // Listen for authentication state changes
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (authUser) => {
                    if (authUser) {
                        // Check if user is verified
                        if (authUser.emailVerified) {
                            setUser(authUser);
                            setView('booking');
                            await loadData();
                        } else {
                            setUser(authUser);
                            setView('verifyEmail');
                        }
                    } else {
                        setUser(null);
                        setView('login');
                    }
                    setLoading(false);
                });

                return () => unsubscribe();
            }, []);

            // Load data from Firebase
            const loadData = async () => {
                try {
                    const [resourcesSnap, servicesSnap, appointmentsSnap, clientsSnap] = await Promise.all([
                        db.collection('resources').get(),
                        db.collection('services').get(),
                        db.collection('appointments').get(),
                        db.collection('clients').get()
                    ]);

                    setResources(resourcesSnap.docs.map(doc => ({ ...doc.data() })));
                    setServices(servicesSnap.docs.map(doc => ({ ...doc.data() })));
                    setAppointments(appointmentsSnap.docs.map(doc => ({ ...doc.data() })));
                    setClients(clientsSnap.docs.map(doc => ({ ...doc.data() })));
                } catch (error) {
                    console.error('Error loading data:', error);
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center tropical-bg">
                        <div className="text-center">
                            <div className="spinner mx-auto mb-4"></div>
                            <p className="text-gray-600 text-lg">Loading Sun Hut Booking...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen tropical-bg p-4">
                    <Header user={user} setView={setView} />
                    
                    {view === 'login' && <LoginForm setView={setView} />}
                    {view === 'register' && <RegisterForm setView={setView} />}
                    {view === 'verifyEmail' && <VerifyEmail user={user} />}
                    {view === 'booking' && (
                        <BookingForm 
                            resources={resources} 
                            services={services} 
                            appointments={appointments}
                            user={user}
                            clients={clients}
                            onBookingComplete={loadData}
                        />
                    )}
                    {view === 'myAppointments' && (
                        <MyAppointments 
                            appointments={appointments}
                            resources={resources}
                            services={services}
                            user={user}
                            clients={clients}
                            onUpdate={loadData}
                        />
                    )}
                </div>
            );
        }

        // Header Component
        function Header({ user, setView }) {
            const handleLogout = async () => {
                await auth.signOut();
            };

            return (
                <div className="card p-4 mb-6 max-w-6xl mx-auto">
                    <div className="flex items-center justify-between flex-wrap gap-4">
                        <div className="flex items-center gap-4">
                            <div className="text-4xl font-bold sun-hut-text-orange">
                                üå¥ THE SUN HUT
                            </div>
                        </div>
                        
                        {user && user.emailVerified && (
                            <div className="flex gap-3">
                                <button
                                    onClick={() => setView('booking')}
                                    className="px-6 py-2 btn-yellow rounded-lg font-semibold"
                                >
                                    Book Now
                                </button>
                                <button
                                    onClick={() => setView('myAppointments')}
                                    className="px-6 py-2 btn-orange text-white rounded-lg font-semibold"
                                >
                                    My Appointments
                                </button>
                                <button
                                    onClick={handleLogout}
                                    className="px-6 py-2 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700"
                                >
                                    Logout
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Login Form Component
        function LoginForm({ setView }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    setError(error.message);
                }
                
                setLoading(false);
            };

            return (
                <div className="max-w-md mx-auto">
                    <div className="card p-8">
                        <h2 className="text-3xl font-bold sun-hut-text-orange mb-6 text-center">
                            Welcome Back! ‚òÄÔ∏è
                        </h2>
                        
                        {error && (
                            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                                {error}
                            </div>
                        )}
                        
                        <form onSubmit={handleLogin}>
                            <div className="mb-4">
                                <label className="block text-gray-700 font-semibold mb-2">Email</label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    required
                                />
                            </div>
                            
                            <div className="mb-6">
                                <label className="block text-gray-700 font-semibold mb-2">Password</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    required
                                />
                            </div>
                            
                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full btn-orange text-white px-6 py-3 rounded-lg font-bold text-lg"
                            >
                                {loading ? 'Logging in...' : 'Login'}
                            </button>
                        </form>
                        
                        <div className="mt-6 text-center">
                            <p className="text-gray-600">
                                Don't have an account?{' '}
                                <button
                                    onClick={() => setView('register')}
                                    className="sun-hut-text-orange font-semibold hover:underline"
                                >
                                    Register Here
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // Register Form Component
        function RegisterForm({ setView }) {
            const [formData, setFormData] = useState({
                firstName: '',
                surname: '',
                email: '',
                password: '',
                confirmPassword: '',
                phone: '',
                dateOfBirth: ''
            });
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };

            const handleRegister = async (e) => {
                e.preventDefault();
                setError('');
                
                // Validation
                if (formData.password !== formData.confirmPassword) {
                    setError('Passwords do not match!');
                    return;
                }
                
                if (formData.password.length < 6) {
                    setError('Password must be at least 6 characters!');
                    return;
                }
                
                setLoading(true);

                try {
                    // Create Firebase Auth user
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        formData.email,
                        formData.password
                    );
                    
                    // Send email verification
                    await userCredential.user.sendEmailVerification();
                    
                    // Create client record in Firestore
                    const newClient = {
                        id: Date.now(),
                        firstName: formData.firstName,
                        surname: formData.surname,
                        name: `${formData.firstName} ${formData.surname}`,
                        email: formData.email,
                        phone: formData.phone,
                        dateOfBirth: formData.dateOfBirth,
                        idVerified: false,
                        skinType: 'Not Set',
                        disclaimerCompleted: false,
                        notes: '',
                        totalVisits: 0,
                        totalSpent: 0,
                        redFlag: false,
                        redFlagNote: '',
                        redFlagDate: '',
                        bookingSource: 'online-widget',
                        firebaseUid: userCredential.user.uid
                    };
                    
                    await db.collection('clients').doc(newClient.id.toString()).set(newClient);
                    
                    // User will be redirected to verify email screen
                } catch (error) {
                    setError(error.message);
                    setLoading(false);
                }
            };

            return (
                <div className="max-w-md mx-auto">
                    <div className="card p-8">
                        <h2 className="text-3xl font-bold sun-hut-text-orange mb-6 text-center">
                            Join Sun Hut! üå¥
                        </h2>
                        
                        {error && (
                            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                                {error}
                            </div>
                        )}
                        
                        <form onSubmit={handleRegister}>
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="block text-gray-700 font-semibold mb-2">First Name</label>
                                    <input
                                        type="text"
                                        name="firstName"
                                        value={formData.firstName}
                                        onChange={handleChange}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-gray-700 font-semibold mb-2">Surname</label>
                                    <input
                                        type="text"
                                        name="surname"
                                        value={formData.surname}
                                        onChange={handleChange}
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                        required
                                    />
                                </div>
                            </div>
                            
                            <div className="mb-4">
                                <label className="block text-gray-700 font-semibold mb-2">Email</label>
                                <input
                                    type="email"
                                    name="email"
                                    value={formData.email}
                                    onChange={handleChange}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    required
                                />
                            </div>
                            
                            <div className="mb-4">
                                <label className="block text-gray-700 font-semibold mb-2">Phone</label>
                                <input
                                    type="tel"
                                    name="phone"
                                    value={formData.phone}
                                    onChange={handleChange}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    required
                                />
                            </div>
                            
                            <div className="mb-4">
                                <label className="block text-gray-700 font-semibold mb-2">Date of Birth</label>
                                <input
                                    type="date"
                                    name="dateOfBirth"
                                    value={formData.dateOfBirth}
                                    onChange={handleChange}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    required
                                />
                            </div>
                            
                            <div className="mb-4">
                                <label className="block text-gray-700 font-semibold mb-2">Password</label>
                                <input
                                    type="password"
                                    name="password"
                                    value={formData.password}
                                    onChange={handleChange}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    required
                                />
                            </div>
                            
                            <div className="mb-6">
                                <label className="block text-gray-700 font-semibold mb-2">Confirm Password</label>
                                <input
                                    type="password"
                                    name="confirmPassword"
                                    value={formData.confirmPassword}
                                    onChange={handleChange}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    required
                                />
                            </div>
                            
                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full btn-orange text-white px-6 py-3 rounded-lg font-bold text-lg"
                            >
                                {loading ? 'Creating Account...' : 'Create Account'}
                            </button>
                        </form>
                        
                        <div className="mt-6 text-center">
                            <p className="text-gray-600">
                                Already have an account?{' '}
                                <button
                                    onClick={() => setView('login')}
                                    className="sun-hut-text-orange font-semibold hover:underline"
                                >
                                    Login Here
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // Verify Email Component
        function VerifyEmail({ user }) {
            const [checking, setChecking] = useState(false);

            const checkVerification = async () => {
                setChecking(true);
                await user.reload();
                setChecking(false);
                
                if (!user.emailVerified) {
                    alert('Please verify your email first. Check your inbox!');
                }
            };

            const resendEmail = async () => {
                try {
                    await user.sendEmailVerification();
                    alert('Verification email sent! Please check your inbox.');
                } catch (error) {
                    alert('Error sending email: ' + error.message);
                }
            };

            return (
                <div className="max-w-md mx-auto">
                    <div className="card p-8 text-center">
                        <div className="text-6xl mb-4">üìß</div>
                        <h2 className="text-3xl font-bold sun-hut-text-orange mb-4">
                            Verify Your Email
                        </h2>
                        <p className="text-gray-600 mb-6">
                            We've sent a verification email to:<br/>
                            <strong>{user.email}</strong>
                        </p>
                        <p className="text-gray-600 mb-6">
                            Please check your inbox and click the verification link to continue.
                        </p>
                        
                        <button
                            onClick={checkVerification}
                            disabled={checking}
                            className="w-full btn-orange text-white px-6 py-3 rounded-lg font-bold text-lg mb-3"
                        >
                            {checking ? 'Checking...' : 'I\'ve Verified My Email'}
                        </button>
                        
                        <button
                            onClick={resendEmail}
                            className="w-full btn-yellow px-6 py-3 rounded-lg font-bold text-lg"
                        >
                            Resend Verification Email
                        </button>
                    </div>
                </div>
            );
        }

        // Booking Form Component
        function BookingForm({ resources, services, appointments, user, clients, onBookingComplete }) {
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [selectedResource, setSelectedResource] = useState(null);
            const [selectedService, setSelectedService] = useState(null);
            const [selectedTime, setSelectedTime] = useState(null);
            const [notes, setNotes] = useState('');
            const [loading, setLoading] = useState(false);

            // Generate time slots (15-minute intervals from 9 AM to 9 PM)
            const generateTimeSlots = () => {
                const slots = [];
                for (let hour = 9; hour < 21; hour++) {
                    for (let minute = 0; minute < 60; minute += 15) {
                        const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                        slots.push(time);
                    }
                }
                return slots;
            };

            const timeSlots = generateTimeSlots();

            // Check if a time slot is available
            const isTimeSlotAvailable = (time) => {
                if (!selectedResource) return false;
                
                const [hours, minutes] = time.split(':').map(Number);
                const slotStart = hours * 60 + minutes;
                const slotEnd = slotStart + (selectedService?.duration || 15);

                const dateAppointments = appointments.filter(
                    apt => apt.date === selectedDate && apt.resourceId === selectedResource.id
                );

                for (const apt of dateAppointments) {
                    const [aptHours, aptMinutes] = apt.startTime.split(':').map(Number);
                    const aptStart = aptHours * 60 + aptMinutes;
                    const [aptEndHours, aptEndMinutes] = apt.endTime.split(':').map(Number);
                    const aptEnd = aptEndHours * 60 + aptEndMinutes;

                    if ((slotStart >= aptStart && slotStart < aptEnd) || 
                        (slotEnd > aptStart && slotEnd <= aptEnd) ||
                        (slotStart <= aptStart && slotEnd >= aptEnd)) {
                        return false;
                    }
                }

                return true;
            };

            const handleBooking = async () => {
                if (!selectedResource || !selectedService || !selectedTime) {
                    alert('Please select a tanning bed, service, and time slot!');
                    return;
                }

                setLoading(true);

                try {
                    // Find client by Firebase UID
                    const client = clients.find(c => c.firebaseUid === user.uid);
                    
                    if (!client) {
                        alert('Client record not found. Please contact support.');
                        setLoading(false);
                        return;
                    }

                    // Calculate end time
                    const [hours, minutes] = selectedTime.split(':').map(Number);
                    const startMinutes = hours * 60 + minutes;
                    const endMinutes = startMinutes + selectedService.duration;
                    const endHours = Math.floor(endMinutes / 60);
                    const endMins = endMinutes % 60;
                    const endTime = `${endHours.toString().padStart(2, '0')}:${endMins.toString().padStart(2, '0')}`;

                    const newAppointment = {
                        id: Date.now(),
                        resourceId: selectedResource.id,
                        clientId: client.id,
                        date: selectedDate,
                        startTime: selectedTime,
                        endTime: endTime,
                        service: selectedService.name,
                        duration: selectedService.duration,
                        price: 0, // Free appointment
                        status: 'confirmed',
                        notes: notes,
                        paidWithCourse: false,
                        courseId: null,
                        bookingSource: 'online-widget'
                    };

                    await db.collection('appointments').doc(newAppointment.id.toString()).set(newAppointment);

                    alert('üéâ Booking Confirmed! See you soon at Sun Hut!');
                    
                    // Reset form
                    setSelectedResource(null);
                    setSelectedService(null);
                    setSelectedTime(null);
                    setNotes('');
                    
                    // Reload data
                    await onBookingComplete();
                } catch (error) {
                    alert('Error creating booking: ' + error.message);
                }

                setLoading(false);
            };

            return (
                <div className="max-w-6xl mx-auto">
                    <div className="card p-8">
                        <h2 className="text-3xl font-bold sun-hut-text-orange mb-6 text-center">
                            Book Your Tanning Session ‚òÄÔ∏è
                        </h2>

                        {/* Step 1: Select Date */}
                        <div className="mb-8">
                            <h3 className="text-xl font-bold mb-4">1. Select Date</h3>
                            <input
                                type="date"
                                value={selectedDate}
                                onChange={(e) => setSelectedDate(e.target.value)}
                                min={new Date().toISOString().split('T')[0]}
                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg"
                            />
                        </div>

                        {/* Step 2: Select Tanning Bed */}
                        <div className="mb-8">
                            <h3 className="text-xl font-bold mb-4">2. Select Tanning Bed</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {resources.filter(r => r.status === 'available').map(resource => (
                                    <div
                                        key={resource.id}
                                        onClick={() => setSelectedResource(resource)}
                                        className={`card p-4 cursor-pointer ${
                                            selectedResource?.id === resource.id 
                                                ? 'ring-4 ring-orange-500 bg-orange-50' 
                                                : ''
                                        }`}
                                    >
                                        <div className="text-2xl mb-2">üõèÔ∏è</div>
                                        <h4 className="font-bold text-lg">{resource.name}</h4>
                                        <p className="text-gray-600 text-sm">{resource.type}</p>
                                        <p className="text-gray-500 text-xs mt-2">{resource.description}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Step 3: Select Service */}
                        {selectedResource && (
                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-4">3. Select Service</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {services.map(service => (
                                        <div
                                            key={service.id}
                                            onClick={() => setSelectedService(service)}
                                            className={`card p-4 cursor-pointer ${
                                                selectedService?.id === service.id 
                                                    ? 'ring-4 ring-orange-500 bg-orange-50' 
                                                    : ''
                                            }`}
                                        >
                                            <h4 className="font-bold text-lg">{service.name}</h4>
                                            <p className="text-gray-600 text-sm mb-2">{service.description}</p>
                                            <div className="flex justify-between items-center">
                                                <span className="text-gray-700 font-semibold">
                                                    {service.duration} mins
                                                </span>
                                                <span className="sun-hut-text-orange font-bold text-lg">
                                                    FREE
                                                </span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Step 4: Select Time */}
                        {selectedService && (
                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-4">4. Select Time</h3>
                                <div className="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3 max-h-96 overflow-y-auto p-2">
                                    {timeSlots.map(time => {
                                        const available = isTimeSlotAvailable(time);
                                        return (
                                            <div
                                                key={time}
                                                onClick={() => available && setSelectedTime(time)}
                                                className={`time-slot p-3 rounded-lg text-center font-semibold ${
                                                    selectedTime === time ? 'selected' : ''
                                                } ${!available ? 'unavailable' : ''}`}
                                            >
                                                {time}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* Step 5: Notes */}
                        {selectedTime && (
                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-4">5. Additional Notes (Optional)</h3>
                                <textarea
                                    value={notes}
                                    onChange={(e) => setNotes(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg"
                                    rows="3"
                                    placeholder="Any special requests or notes..."
                                />
                            </div>
                        )}

                        {/* Booking Summary & Confirm Button */}
                        {selectedTime && (
                            <div className="bg-orange-50 border-2 sun-hut-border-orange rounded-lg p-6">
                                <h3 className="text-xl font-bold mb-4">Booking Summary</h3>
                                <div className="space-y-2 mb-6">
                                    <p><strong>Date:</strong> {selectedDate}</p>
                                    <p><strong>Tanning Bed:</strong> {selectedResource.name}</p>
                                    <p><strong>Service:</strong> {selectedService.name} ({selectedService.duration} mins)</p>
                                    <p><strong>Time:</strong> {selectedTime}</p>
                                    <p className="text-2xl font-bold sun-hut-text-orange">Price: FREE</p>
                                </div>
                                
                                <button
                                    onClick={handleBooking}
                                    disabled={loading}
                                    className="w-full btn-orange text-white px-6 py-4 rounded-lg font-bold text-xl"
                                >
                                    {loading ? 'Booking...' : 'üéâ Confirm Booking'}
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // My Appointments Component
        function MyAppointments({ appointments, resources, services, user, clients, onUpdate }) {
            const [loading, setLoading] = useState(false);

            // Get current client
            const client = clients.find(c => c.firebaseUid === user.uid);
            
            // Filter appointments for current user
            const myAppointments = appointments
                .filter(apt => apt.clientId === client?.id)
                .sort((a, b) => {
                    const dateA = new Date(a.date + 'T' + a.startTime);
                    const dateB = new Date(b.date + 'T' + b.startTime);
                    return dateB - dateA;
                });

            const upcomingAppointments = myAppointments.filter(apt => {
                const aptDate = new Date(apt.date + 'T' + apt.startTime);
                return aptDate >= new Date();
            });

            const pastAppointments = myAppointments.filter(apt => {
                const aptDate = new Date(apt.date + 'T' + apt.startTime);
                return aptDate < new Date();
            });

            const handleCancelAppointment = async (appointmentId) => {
                if (!confirm('Are you sure you want to cancel this appointment?')) {
                    return;
                }

                setLoading(true);
                try {
                    await db.collection('appointments').doc(appointmentId.toString()).delete();
                    alert('Appointment cancelled successfully!');
                    await onUpdate();
                } catch (error) {
                    alert('Error cancelling appointment: ' + error.message);
                }
                setLoading(false);
            };

            const AppointmentCard = ({ appointment, isPast }) => {
                const resource = resources.find(r => r.id === appointment.resourceId);
                
                return (
                    <div className="card p-6 mb-4">
                        <div className="flex justify-between items-start">
                            <div className="flex-1">
                                <div className="flex items-center gap-3 mb-2">
                                    <span className="text-2xl">üõèÔ∏è</span>
                                    <h4 className="font-bold text-xl">{resource?.name || 'Unknown Bed'}</h4>
                                </div>
                                
                                <div className="space-y-1 text-gray-600">
                                    <p><strong>Service:</strong> {appointment.service}</p>
                                    <p><strong>Date:</strong> {appointment.date}</p>
                                    <p><strong>Time:</strong> {appointment.startTime} - {appointment.endTime}</p>
                                    <p><strong>Duration:</strong> {appointment.duration} minutes</p>
                                    {appointment.notes && (
                                        <p><strong>Notes:</strong> {appointment.notes}</p>
                                    )}
                                </div>
                                
                                <div className="mt-3">
                                    <span className={`inline-block px-3 py-1 rounded-full text-sm font-semibold ${
                                        appointment.status === 'confirmed' ? 'bg-green-100 text-green-800' :
                                        appointment.status === 'completed' ? 'bg-blue-100 text-blue-800' :
                                        'bg-gray-100 text-gray-800'
                                    }`}>
                                        {appointment.status.charAt(0).toUpperCase() + appointment.status.slice(1)}
                                    </span>
                                </div>
                            </div>
                            
                            {!isPast && (
                                <button
                                    onClick={() => handleCancelAppointment(appointment.id)}
                                    disabled={loading}
                                    className="ml-4 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700"
                                >
                                    Cancel
                                </button>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="card p-8">
                        <h2 className="text-3xl font-bold sun-hut-text-orange mb-6 text-center">
                            My Appointments üìÖ
                        </h2>

                        {/* Upcoming Appointments */}
                        <div className="mb-8">
                            <h3 className="text-2xl font-bold mb-4">Upcoming Appointments</h3>
                            {upcomingAppointments.length === 0 ? (
                                <div className="text-center py-8 bg-gray-50 rounded-lg">
                                    <p className="text-gray-600 text-lg mb-4">No upcoming appointments</p>
                                    <p className="text-gray-500">Book your next tan now!</p>
                                </div>
                            ) : (
                                upcomingAppointments.map(apt => (
                                    <AppointmentCard key={apt.id} appointment={apt} isPast={false} />
                                ))
                            )}
                        </div>

                        {/* Past Appointments */}
                        {pastAppointments.length > 0 && (
                            <div>
                                <h3 className="text-2xl font-bold mb-4">Past Appointments</h3>
                                {pastAppointments.slice(0, 5).map(apt => (
                                    <AppointmentCard key={apt.id} appointment={apt} isPast={true} />
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<BookingWidget />, document.getElementById('root'));
    </script>
</body>
</html>
